---
layout: post
title: "week of 20 may"
date: 2019-05-20
---

### 20 may

This week is going to be all about figuring out the alerts app/API in docker/php 5.5, then transferring it to 7.2. 

#### exploring the app/API

I started the day going one-by-one through the global functions. I didn't get very far before I realized the word "alerts" isn't even present in the functions file. I decided to switch gears and focus on the API files.

The API never adds the server/host parameter for the `gConnectDB` function, so it is defaulting to "localhost". As I learned last week, "localhost" doesn't work for the docker container. I thought I was being clever by trying to rename the docker mysql service "localhost" instead of "mysql," but it only caused connection errors (no surprise there). A good waste of a half hour, I'd say. Lesson learned!

Instead, I'll try updating the default parameter to "mysql". That seems to be working, but the API endpoint still isn't connecting, so it's back to the drawing board.

#### apache and .htaccess

I'm trying **really** hard to wrap my head around this API stuff, so I decided to go back and read through the [creating a restful api](http://coreymaynard.com/blog/creating-a-restful-api-with-php/) blog post again. I realized that there's the whole section about the `.htaccess` file and it explains the routing of the API endpoints-- which happen to be my issue right now!

First up: the block of code in the blog post is already in my `.htaccess` folder, so no problem there. Next thing to check: this code is checking if the rewrite module is installed. I'm pretty sure the first few docker containers I built did *not* have this module installed, but I guess whatever instructions I followed in the end realized most php developer would need this module?? Because it's in my Dockerfile `RUN` statement and gets installed during the build. I used `sudo a2enmod rewrite` in the shell of the php/apache container just to double check, but it's definitely installed. Second check all good.

After making sure those things were in place, I started to dig deeper into the apache configuration on our dev server, and let's just say it's complicated. I decided to try adding a `VirtualHost` override setting to my `apache2.conf` file, as explained in this stack overflow: [How to check whether mod_rewrite is enabled?](https://stackoverflow.com/questions/7337724/how-to-check-whether-mod-rewrite-is-enable-on-server). 

After messing with these settings for a few hours, I just don't know what it is I'm supposed to changing or what pieces of code are causing things to happen/not happen. I might need a much deeper dive on server configuration and apache settings... or take more time to look through the config files on the dev and live server. 

### 21 may

Spent the morning reading through/watching LibCal documentation/videos. 

Now I'm back to working on this apahce config issue. I googled the latest error: `AH01276 cannot serve directory server generated directory index forbidden by Options directive`. I thought this was odd becuase the `apahce2.conf` file I wrote has `Options Index` listed for the `var/www` directory... so I decided to try the VirtualHost setting again. 

Good news! The directory is now loading instead of giving me a `Forbidden` error! But the API endpoints are still an issue.

Now instead of getting `Forbidden: /alerts/api` I'm getting `Not Found: The requested URL /alerts/api/getAPI.php was not found on this server.` Two things about this: 1) That file definitely exists in that directory and I double checked using `docker exec`; 2) How does the server know to look for `getAPI.php` specifically??

My first thought was maybe a permissions error on the files themselves? So I double-checked the permissions of the files on the dev server, and those are the same as the ones in my docker container. The ones on the dev server are being served/accessed just fine, so that's not it.

### 22 may

Another LibCal morning. Now back to API/apache confusion.

After an ENTIRE AFTERNOON of spinning my wheels and trying to figure out where exactly this thing is breaking down, I decided as a Hail Mary sort of touchdown pass last-ditch effort to comment out some external libraries that don't affect the alerts app. LO AND BEHOLD I get back a bunch of errors and stuff BUT ALSO THE JSON DATA FROM THE ENDPOINT. 

I'm so happy right now I could cry. But instead, I'll go home and enjoy an anniversary dinner with my boo.
