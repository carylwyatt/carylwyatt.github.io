---
layout: post
title: "week of 01 jul"
date: 2019-07-01
---

### 01 jul 

Sleepy Monday, but time to get back on that grind.

The items on my to-do list are not necessarily related, so I think I'll spend the morning working on this docker version control issue, then pivot to the intranet stuff after lunch. I'm still waiting to hear about the outcome of the forms issue before I spend any more time debugging that app (in case we decide to scrap it entirely).

#### vc'ing that docker container

Where I left off: I thought I'd wiped the git configuration of the roots theme repo before pushing it up to github, but it ended up as a submodule anyway. 

I'm going to try:
- pushing the changes I've currently made to theme up to the `roots-ualib` repo as a new branch
- creating a new docker/wordpress container 
- adding that theme as a submodule, pulling directly from that branch/commit

We'll see what happens!

I think I did it! Took a few tries, but here's what worked:

- Copied the `wp-docker-apps` directory to `docker-roots-app`
- Deleted the `roots-ualib` theme directory
- Did an `rm -rf .git` at the root to get rid of all version history
- Created new private github repo
- `git init`
- `git add .`
- `git commit -m "first commit"`
- `git remote add origin <url>`
- `git push -u origin master`
- Copied url of `roots-ualib` repo
- `cd app/wp-content/themes/`
- `git submodule add -b docker https://github.com/ualibweb/roots-ualib.git`
- cd up to the top of the directory, `cat .gitmodules` to make sure it's there
- cd to `/themes/roots-ualib` and see it's already checked out to `docker` branch

Success???

The good news: the submodule is working. The bad news: now I have to figure out how to run the grunt build and pull in the vendor libraries without overwriting all the filepath changes I made. Maybe a challenge for another day?

I've spent a good while trying to undo the dumb-dumb mistake I made in this new docker container. I'm glad I'm trying this out in a test repo and not using the repo/container with my actual stuff in it! Learned a lot about `git reflog` and `git reset`, but I can't figure out how to unstage the changes I made in my submodule without deleting it and starting again. Which might be a good idea? That didn't work either for some reason. Getting the error "wp-content/themes/root-ualib already exists in the index". Tried some `git rm --cached roots-ualib` and removing of git submodules and stuff, but it ain't working. So I'mma delete the whole thing and pull it down fresh. BOOOOO 

When cloning from the repo with the submodule already in it, don't forget to cd to the roots directory, then `git submodule update --init` so it will clone the submodule files and set the commit/remote/whatever.

Lesson learned: don't try to set the WP theme to roots until you've run the grunt build. You're gonna have a bad time.

All in all, a successful day with the version control and git setups. I also did some ticket work/troubleshooting on LibCal, so it was sort of in and out of learning this stuff and handling that.

### 02 jul

Today, I'm focusing on the migration of the intranet from drupal to WP. Things I need to figure out:

- Will our modified UA child theme work for this project?
- Does our child theme have any issues with UA's latest version of the theme?
- Authorization:
  - LDAP plugin?
  - Active directory?
  - Are there any intranet-type plugins we can use to limit authorization to IP ranges?
- User roles/permissions per different areas of the site

#### UA WP theme

I think UA Strat Comm must keep its theme locked down to an extent because there's no option to update the theme from the backend of WP. I went to their site and there was a page for download, so that's what I did. We have v1.5.6 installed on our center for the book blog (who knows where else), but the latest version is 1.7.4, so there's probably lots of changes.

I installed it and Rudaina's child version and activated the child theme. Our nav bar is not what I expected it to be? So there must be some settings I need to investigate. The good news is it's not entirely broken.

Turns out yes, there are plenty of settings that need to be set for this theme. I'm going through them currently, but I need to start putting in content for it to look like anything, so I'm going to leave off on that until I have more direction on content. 

#### Plugins for auth

The two auth/login type plugins we already use: 
- [Peter's login redirect](https://wordpress.org/plugins/peters-login-redirect/) (update 4 months ago)
- [Simple LDAP Login](https://wordpress.org/plugins/simple-ldap-login/) (3+ years since update)

Peter's redirect plugin only redirects specific users/roles to a page on login, so might not be super useful. But! I do find it annoying that logging in to WP takes you to the dashboard... so maybe that will come in handy to redirect people back to the blog/intranet page.

The Simple LDAP Login plugin seems to be working on our website and blogs. It's somewhat worrisome that it hasn't been updated in 3 years, but it seemed to be working in my docker PHP 7.2 tests, so maybe we should just roll with it and wait and see?

In my research, I found two other candidates for auth plugins:
- [Active Directory Integration/LDAP Integration](https://wordpress.org/plugins/ldap-login-for-intranet-sites/)
  - Updated 3 weeks ago
  - People seem to really appreciate their customer service
  - Other people upset that new premium features limited the free version
- [WP Cassify](https://wordpress.org/plugins/wp-cassify)
  - Updated 3 months ago
  - Comments/reviews mention universities using to manage users
  - Not sure if CAS would be enough to narrow down to solely library employees

### 3 jul

At our meeting yesterday, we decided to roll with the current LDAP plugin and see what happens. Jennifer is not sure we'll be able to set it up differently for a site under the multisite settings. The plugin on the multisite is set up to auth against the full university LDAP, but we want the plugin to use just the *library* active directory, and it's unclear if we can do that on an individual site basis under a multisite install. That's what I'll be testing in the next few days!

#### forms app

Before I get to that, though, I want to tie up the forms app loose ends. It was determined during our meeting that no one is actually using the forms app or else we would've heard it wasn't working **months** ago. So fixing that SQL query/PHP memory issue is no longer a priority. Instead, I'll be adding a message to the app front-end alerting users to contact us if they need help with form data. Should be easy, but I haven't actually updated any of these angular apps before, so it should be fun!

#### WP multisite

So here's the deal: I'm going to install a new WP site in the multisite /blogs directory. It's been a few years since I've handled a mutlisite install, so this could take some time to research. I'll be working on the dev server in case I blow something up.
