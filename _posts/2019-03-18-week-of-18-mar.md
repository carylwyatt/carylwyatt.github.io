---
layout: post
title: "week of 18 march"
date: 2019-03-18
---

### 18 mar

Things got hectic at the end of Friday before spring break. Because I was hustlin' so hard, I didn't have time to update the log. Let's see if I can recap and update with today's fixes.

I think this whole thing can be boiled down to: 

- I'm still new 
- this was my first time pushing to the deploy repo 
- there is scant documentation on the codebase/git workflow

All of that added up to a bit of a storm when a request was made to **push to production on the Friday before spring break**. Thankfully, this was a pretty minor update, so it wasn't a huge deal that it didn't end up happening last week. Still, what I pushed to production broke the homepage, and even after fixing it last week and updating it today, I'm not sure *why* that happened. Here comes the post mortem.

We received a "feature request" for a new box on the homepage. The requester originally wanted a sort of CRUD application style plugin where anyone who is logged in to wordpress can update the box (basically a mini-blog). When it came down to it though, it just needed to be a box with an image in it that pointed to a blog. HOWEVER, because of the nature of the original request, I started working on that stuff I wrote about last Friday with the JSON data, GET auth/permissions, etc. I also started digging into how to build an Angular module (complete with directive/controller), which I was building outside the local build in order to get my head around the concepts before breaking anything.

When it got to be around 3PM, it was clear that the box with linked image was going to have to be the solution for now. Because of all the previous digging I had done, some of the changes I'd unknowingly made to my local codebase were also pushed to the live site. These changes broke the homepage. [Sidenote: I'm **baffled** by this because I never ran the live-build compile step. If my changes weren't added to the `.min` files (couldn't have been, because those `.min` files are only compiled during when `grunt live-build` is run, which I didn't even know existed until this morning), then they couldn't have been live, even if they were pushed to the deploy repo. The only explanation that makes sense to me is something from my files must've messed with a GitHub hook we have set up. And I don't know anything about those yet, so it's just speculation at this point.]

We had a lot of fun scrambling to revert commits and reset the HEAD and undo merges at 4:45PM. I definitely learned a lot about undoing stuff. I hope I don't need it again, but I probably will. 

ALL THAT TO SAY: When Jared was here this morning, I had him walk me through his workflow for pushing to the deploy repo, and I learned all about the `grunt live-build` command that builds the `.min` files. I've now written out a complete workflow that includes creating a branch locally so future reverts/resets won't be so complicated. Here is that workflow in all its glory:

#### building locally, pushing to dev

- create a new branch: `git checkout -b caryl-feature-name`
- run grunt to compile local/dev build: `grunt default`
- commit as you go!
  - `git status` to see changes to be staged
  - `git commit -am "concise message"`
- when you need to push, push your branch to the `ualibweb/roots-ualib` repo with `git push origin caryl-feature-name`
- when ready to merge branch to dev, create pull request to **dev** (need to change the request location dropdown in pull request) to see changes on `wwwdev2` server
- merge pull request
- once merged, delete branch `git branch -d caryl-feature-name`

#### ready to go live? pull request checklist

- make sure links and images point to live server (i.e. no `wwwdev2` links/images)
- run `grunt live-build` to build minified files
- push to dev `git push origin master`
- create pull request to `ualib-deploy`
- let steven know so he can merge

