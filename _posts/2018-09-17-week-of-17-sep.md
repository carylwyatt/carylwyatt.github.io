---
layout: post
title: "week of 17 september"
date: 2018-09-17
---

### recap

This is a continuation of an ongoing series of work logs following my journey to dockerize my people counter raspberry pi app. I feel like I'm almost done with it, but every day is a new discovery of things I didn't know I needed to do, followed by figuring out how to do those things. Follow along if you like, and feel free to go back through the annals of time:
- [a summary of july](http://carylwyatt.github.io/blog/2018/08/03/work-log-jul-30)
- [week of 6 august](http://carylwyatt.github.io/blog/2018/08/06/week-of-6-august)
- [week of 13 august](http://carylwyatt.github.io/blog/2018/08/13/week-of-13-august)
- [week of 20 august](http://carylwyatt.github.io/blog/2018/08/20/week-of-20-august)
- [week of 10 september](http://carylwyatt.github.io/blog/2018/09/10/week-of-10-sep)

### 17 sep

Continuing my quest to configure email on the pi. Since I plugged in the original SD card, it doesn't have any of the mail stuff I installed on the other SD card. I'm following the instructions from the raspberry pi forum post [No mail command with heirloom-mailx on Raspbian-Stretch](https://www.raspberrypi.org/forums/viewtopic.php?t=205603) then re-following the [sending email via gmail in linux](http://thelinuxtips.com/2011/09/19/sending-email-via-gmail-in-linux/) post and hoping for the best.

This approach worked as long as I use the command `mail` instead of `mailx`. Now to figure out how to configure the `unattended-upgrades` email...

There are many layers to this email business. I thought `mailx` was a program, but turns out it's just a command line tool to pass mail to your Mail Transfer Agent (sendmail, postfix, etc.). I ended up following the advice in the "No mail command..." post linked above and symlinked the commands `mail` and `mailx` to `heirloom-mailx`. I ran a test using both `mail` and `mailx` and they both sent email, so I'm going to say I'm good. Now I need to swap out the SD cards and update the other card and run the `unattended-upgrades` dry run to make sure it's sending the update email.

Ugghh, I installed too much crap on Thursday. Gotta uninstall `sendmail`:
- `sudo apt-get removed sendmail`
- `sudo apt-get purge sendmail*`
  - that asterisk is important, yo

Here's what ended up working:
- install heirloom-mailx: `sudo apt-get install heirloom-mailx`
- create mail config: `vim ~/.mailrc`
- add these lines:
  ```
  account gmail {
    set smtp-use-starttls
    set smtp=smtp://smtp.gmail.com:587
    set smtp-auth=login
    set smtp-auth-user=abcd@gmail.com
    set smtp-auth-password=mypassword
    set from="ABCD "
  }
  ```
- replace the last three lines with gmail stuff, including the gmail email between quotes on the last line
- set up symlinks for mail and mailx commands:
  - `sudo ln -s /usr/bin/heirloom-mailx /usr/bin/mail`
  - `sudo ln -s /usr/bin/heirloom-mailx /usr/bin/mailx`
- test with this command:
  - `echo "Test Email" | mailx -v -A gmail -s "test" yyyyyyyy@gmail.com`
