---
layout: post
title: "work log - first attempt"
date: 2018-08-03
---
I'm going to try a new thing. I keep a million tabs open all the time, and I'm pretty tired of it. I also need a place to keep track of projects and my line of thinking while working on them. I'm so often interrupted in the middle of a project and can't get back to it for weeks or months, and when I open a project file, it takes me forever to figure out my train of thought or what I was even working toward. Maybe with some notes and links I'll be able to keep track of this stuff so I can get back up to speed faster. Maybe not. But it's worth a shot.

I've been keeping paper notes of my latest project. It filled a bunch of space, so it's hard to jump around and see important bits at a glance. I'm going to type these up here with the hope that I will be able to search for them in the future.

## raspberry pi image / docker image of people counter app

### 2 july

Trying to think through this imaging thing...

What if I...
- fork noobs image on GH
- install Docker on image
- user Docker to pull down people-counter app locally
- push back up to cloud

But how would I pull down raspberry pi updates/upgrades? Obviously docker will run my app on whichever version of raspbian I want, but to keep the pis secure, I'll need to be able to pull down upgrades of OSes via `apt-get unattended-upgrades`

Other things to do (see [5 best basic security tips](http://kamilslab.com/2017/01/29/5-best-basic-security-tips-and-tricks-every-raspberry-pi-user-needs-to-take/)):
- delete user pi
- set up SSH
- auto-update/auto-upgrade

I'm having a hard time wrapping my brain around this, but maybe pretend I want to run this at home... I don't have raspbian installed on my home machine, but my people-counter image *will* have raspbian. I'm caught up on why I need raspbian on the SD card *and* in the Dockerfile, but I think the previous is why. Docker will run whichever version of raspbian I want, even if my Pi is auto-upgrading. See [Simple way to build a custom Docker-ready raspberry pi image](https://jonasrosland.com/simple-way-to-build-a-custom-docker-ready-raspberry-pi-image/).

### 3 july

I think I figured out the docker container mess, so onto creating an image for people-counter.

#### Steps I took

1. create new directory `docker-container`
1. `cp gate-counter.js` from old dir => `docker-counter`
1. `npm init` (`package.json`)
1. `npm install --save` (packages from README)
1. run `sudo node gate-counter.js` to make sure it initializes GPIOs
1. create Dockerfile, .dockerignore
1. added script `start: sudo node gate-counter.js` to `package.json`
1. build testing!
	- `$ sudo docker build -t carylwyatt/docker-counter`
	- build failing during step 4: npm install
		- thought it might be related to sudo issues, so I added 'pi' as `$USER` to docker, but still failing
		- tried to install each package individually to figure out which one was causing issues; turns out it's `raspi-io`
		- `raspi-io` README notes: "warning: this module must be installed as a normal user, but run as the root user" *whaaaaaaaat.*
		- now trying to figure out how to add user, give permissions, switch user, & npm install
	- changed users and permissions and still got the error...
	- when I get back on 5 july, start by trying to build docker container in `~/new-test` and go from there!

### 5 july

After getting back up to speed, several stack overflow helper are suggesting either/both clearing the cache `npm cache clean` and/or deleting `node_modules`. Buuuuuut my `.dockerignore` file already includes `node_modules`, so those shouldn't be there anyway, yes? 

#### more steps

Since `pigpio` is the hold-up, I RTFM and it has to be installed locally *before* `npm install`
- my container only had node, so I tried `apt-get install pigpio` but that failed
  - error message: `E: unable to locate package pigpio`
- docs indicated `pigpio` comes installed on raspbian jessie 2016 and later, so I decided to build container `FROM resin/raspberry-pi-node` but got same error (unable to locate `pigpio`)
- **cannot** figure out resin's base images
  - there are generic "raspberry pi" but also
    - some for RPi 3
    - some for RPi 3-node
    - but somehow none of them have the latest raspbian, stretch
- tried `raspberrypi3-node:onbuild`
  - github file claims it's Jessie with node v8
- tried installing `pigpio` as dependency in `package.json` before it was needed, no avail
- BUT THIS FIXED IT, YO
  - all hail [this digital ocean post: How to debug and fix common docker issues](https://www.digitalocean.com/community/tutorials/how-to-debug-and-fix-common-docker-issues)
	- used `resin/raspberrypi3-node:latest` base image
	- used `RUN apt-get clean && apt-get update` then `RUN apt-get install pigpio`
	- which resulted in FIRST SUCCESSFUL BUILD OF IMAGE
- the app isn't running inside the container, so that will need to be fixed on monday
	- error: looks like an i2c problem, no surprise there
	- tried "reboot" of container since I got the message about not using i2c untill restart
