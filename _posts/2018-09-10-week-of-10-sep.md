---
layout: post
title: "week of 10 september"
date: 2018-09-10
---

### 10 sep

I FIGURED IT OUT, Y'ALL.

Turns out, I needed to use `ENTRYPOINT [ "npm", "start" ]` instead of `CMD [ "npm", "start" ]`. Now when I build the image and run it, it creates a new board, initializes a REPL, calibrates the sensor, and starts counting **without closing the board.**  It's a true miracle. 

So tomorrow:
- update github repo
- update README
- push update to Docker
- pull new Docker image to new SD card

:tada::tada::tada:

### 11 sep

After thinking about my next steps, I decided to try out environment variables before pushing all of the updates to git/docker hub. 

Environment variables will help keep this project as automated as possible. The LibInsight API uses different tokens for each stream of data (in our case, each counter or each door), so we need a way to update that auth token for each device without opening individual files. After some research (and talking with Scott), environment variables are the best option because they can be set in the Dockerfile but then overwritten via run command. 

Unfortunately, I've hit yet another brick wall. I set up my ENV variable in the Dockerfile, but for whatever reason, my app won't read it. Even when I overwrite it in the run command:
```
docker run -it -e WORLD="world" --cap-add=ALL --privileged -v /lib/modules:/lib/modules caryl/counter
```

My node app has a line with the `process.env.WORLD` variable in a log:
```
console.log('Hello ' + process.env.WORLD);
```

But when I run the program, I get `Hello undefined`. Frustrating. Even when I go in through `exec /bin/bash`, I can't get it to respond with hello world. I tried setting `const WORLD = process.env.WORLD;` and having the log read from `${WORLD}` variable, but no dice. I tried to get the REPL to tell me what `WORLD` was set to, but it returned `WORLD is not defined`. :sob::sleepy:

I'm thinking maybe I'll take this thing home and see if Scott can figure it out. I'm out of my depth here. I've googled ALL THE THINGS but keep getting the same stack overflows. I watched youtube videos and it looks like I'm doing the **exact same thing** as them, so it might be something I just can't see. *sigh...*

Update! Took this thing home and worked with Scott for a bit. We troubleshot until we realized the variable just needed to be set higher in the javascript doc... womp womp. But yay!

### 12 sep

Now that I've got the environment variables working, I tested it on the libinsight API, and everything worked! :tada:

So now... do all the updates? Or move to writing the bash script?

Went back and read my log. Looks like I wanted to fix the board closing (did it!) and figure out unattended upgrades/bash script before moving on to pushing/flashing anything else. Here goes.
